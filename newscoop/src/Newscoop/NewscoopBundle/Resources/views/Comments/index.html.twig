{% extends 'NewscoopNewscoopBundle::admin_layout.html.twig' %}
{% trans_default_domain "new_comments" %}

{% block admin_title %}{{ parent() }} - {{ 'comments.label.comments'|trans }}{% endblock %}
{% block admin_page_title_content %}{{ 'comments.label.comments'|trans }}{% endblock %}

{% block admin_stylesheets %}
<link rel="stylesheet" href="{{ asset('/bundles/newscoopnewscoop/css/comments.css') }}">
<link rel="stylesheet" href="{{ Newscoop['WEBSITE_URL'] }}/admin-style/comments.css">
<link rel="stylesheet" type="text/css" href="{{ Newscoop['WEBSITE_URL'] }}/bundles/newscoopnewscoop/css/DT_bootstrap.css">
{% endblock %}

{% block admin_scripts %}
<script type="text/javascript" src="{{ Newscoop['WEBSITE_URL'] }}/bundles/newscoopnewscoop/js/DT_bootstrap.js"></script>
{% endblock %}

{% block admin_content %}
<div class="plugin-container">
    <div id="showComments">
        <form method="post" action="">
        <fieldset class="filters">
            <legend>Show</legend>
            <ul class="list-inline">
                <li class="new">
                    {{ form_widget(filterForm.new, { checked : defaultValues.new }) }} {{ form_label(filterForm.new) }}
                </li>
                <li class="approved">
                    {{ form_widget(filterForm.approved) }} {{ form_label(filterForm.approved) }}
                </li>
                <li class="hidden">
                    {{ form_widget(filterForm.hidden) }} {{ form_label(filterForm.hidden) }}
                </li>
                <li class="hidden">
                   {{ form_widget(filterForm.recommended) }} {{ form_label(filterForm.recommended) }}
                </li>
                <li class="hidden">
                    {{ form_widget(filterForm.unrecommended) }} {{ form_label(filterForm.unrecommended) }}
                </li>
                <li>{{ form_widget(filterForm.filterButton, { 'attr': { 'class': 'btn btn-default btn-xs'} }) }}</li>
                {{ form_rest(filterForm) }}
            </ul>
        </fieldset>
        </form>
    </div>
    <div class="table-responsive">
        <table class="table table-bordered" id="commentsTable">
            <thead>
                <tr>
                  <th><input class="toggle-checkbox" type="checkbox"></th>
                  <th>Author</th>
                  <th>Date / Comment</th>
                  <th>Article</th>
              </tr>
            </thead>
            <tbody>
                {% if pagination.getTotalItemCount > 0 %}
                {% for row in pagination %}
                <tr>
                    <td style="width: 3%;">
                        <input type="checkbox" name="index[]" value="{{ row.comment.id }}" class="table-checkbox"><span class="index">{{ row.index }}. {{ row.comment.status }}</span>
                    </td>
                    <td>
                        <div class="commentUserHolder">
                            <div>
                                <img src="http://www.gravatar.com/avatar/{{ row.avatarHash }}?s=50&amp;d=wavatar&amp;r=g">
                            </div>
                            <p></p>
                            <p>
                            {% if row.comment.commenter.user is empty %}
                                {{ row.comment.commenter.name }} ({{ 'comments.label.anonymous'|trans }}) {% if row.banned %} <span class="label label-danger">{{ 'comments.label.banned'|trans }}</span>{% endif %}
                            {% else %}
                                <a href="/profile/{{ row.comment.commenter.name }}">{{ row.comment.commenter.name }}</a>{% if row.banned %} <span class="label label-danger">{{ 'comments.label.banned'|trans }}</span>{% endif %}</p>
                            {% endif %}
                            <p><a target="_blank" href="http://www.ip-adress.com/ip_tracer/{{ row.comment.commenter.ip }}">{{ row.comment.commenter.ip }}</a></p>
                            <p><a href="mailto:{{ row.comment.commenter.email }}">{{ row.comment.commenter.email }}</a></p>
                            <a href="/admin/comment-commenter/toggle-ban/format/json/commenter/{{ row.comment.commenter.id }}/thread/{{ row.comment.thread.number }}/language/{{ row.comment.language.id }}" class="btn btn-default btn-xs ban-btn"><span class="glyphicon glyphicon-ban-circle"></span> Ban/Unban user</a>
                            <p></p>
                        </div>
                    </td>
                    <td style="width: 40%;">
                        <div class="dateCommentHolder">
                            <h4>
                                <span>{{ row.comment.timeCreated|date("Y.m.d") }} {{ 'comments.label.at'|trans }} {{ row.comment.timeCreated|date("H:i:s") }}</span>
                                <span class="commentSubject">
                                    {% if row.comment.subject|length > 50 %}
                                    {{ row.comment.subject|slice(0, 50) }}...
                                {% else %}
                                    {{ row.comment.subject }}
                                {% endif %}
                                </span>
                            </h4>
                            <p class="commentBody">
                                {% if row.comment.message|length > 400 %}
                                    {{ row.comment.message|slice(0, 400) }}...
                                {% else %}
                                    {{ row.comment.message }}
                                {% endif %}
                            </p>
                        </div>
                    </td>
                    <td>
                        <div class="commentArticleHolder">
                            <p>
                                <a href="/admin/articles/get.php?f_publication_id={{ row.comment.thread.publication.id }}&amp;f_issue_number={{ row.issueNumber }}&amp;f_section_number={{ row.comment.thread.section.number }}&amp;f_article_number={{ row.comment.thread.number }}&amp;f_language_id={{ row.comment.thread.language.id }}&amp;f_language_selected={{ row.comment.thread.language.id }}" class="articleLink">{{ row.comment.thread.name }}</a><br>
                                <span>{{ row.comment.thread.publication.name }} - <b>Section</b> {{ row.comment.thread.section.name }}</span>
                            </p>
                            <a class="goToArticle" href="/admin/articles/edit.php?f_publication_id={{ row.comment.thread.publication.id }}&amp;f_issue_number={{ row.issueNumber }}&amp;f_section_number={{ row.comment.thread.section.number }}&amp;f_article_number={{ row.comment.thread.number }}&amp;f_language_id={{ row.comment.thread.language.id }}&amp;f_language_selected={{ row.comment.thread.language.id }}">Go to edit article</a> 
                        </div>
                    </td>
                </tr>
                {% endfor %}
                {% else %}
                <tr><td colspan="7">{{ 'comments.label.noentries'|trans }}</td></tr>
                {% endif %}
            </tbody>
        </table>
        {% if pagination.getTotalItemCount > 0 %}
        <div class="row">
            <div class="col-xs-3 col-sm-4 col-md-5">
                <div class="dataTables_info" id="commentsTable_info">
                    {{ 'comments.label.showing'|trans }} 
                    {% if pagination.getItems|length == 0 %} 0 {% else %} 1 {% endif %} {{ 'comments.label.to'|trans }} {{ pagination.getItems|length }} {{ 'comments.label.of'|trans }} {{ pagination.getTotalItemCount }} {{ 'comments.label.entries'|trans }}.
                </div>
            </div>
            <div class="col-xs-9 col-sm-8 col-md-7 text-right"></div>
        </div>
        {% endif %}
        <div class="pagination-wrapper">
            <ul class="pagination pagination-sm">
            {{ knp_pagination_render(pagination) }}
            </ul>
        </div>
    </div>
</div>
{% endblock %}