#!/bin/bash

. ../../make.env

echo -n -e "\t\tWriting macros.m4..."
cat > macros.m4 << EOF
changecom\`'dnl
changequote(<*, *>)dnl
define(<*X_COPYRIGHT*>, <*<table cellpadding="0" cellspacing="0" width="100%"><tr><td style="padding-left: 5px;"><a STYLE="font-size:8pt;color:#000000" href="http://www.campware.org" target="campware">Campsite 2.2.0 &copy 1999-2005 MDLF, maintained and distributed under GNU GPL by CAMPWARE</a></td></tr></table>*>)dnl
EOF
[ $? -ne 0 ] && echo "ERROR" && exit 1
cat "./macros.in" >> macros.m4
[ $? -ne 0 ] && echo "ERROR" && exit 1
echo OK

cdirs=`find . -maxdepth 1 -type d -print | cut -f 2 -d "/"`
for dir in $cdirs; do
    if [ -x ${dir}/configure ] && [ "$dir" != "." ]; then
	echo -e "\tConfiguring implementation/management/$dir ..."
	cd $dir && ./configure
	result=$?
	cd ..
	[ $result -ne 0 ] && exit 1
    fi
done
